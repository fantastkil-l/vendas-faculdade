document.addEventListener('DOMContentLoaded', () => {
  const adicionarButtons = document.querySelectorAll('.adicionar');
  const totalCompraElement = document.getElementById('total-compra');
  let total = 0;

  // Gera o QR Code inicial com total 0.00
  atualizaQRCodePix(total);

  adicionarButtons.forEach((button) => {
    button.addEventListener('click', () => {
      const priceSpan = button.parentElement.querySelector('span');
      if (priceSpan) {
        const rawPrice = priceSpan.textContent.replace('R$', '').trim();
        const price = parseFloat(rawPrice);
        if (!isNaN(price)) {
          total += price;
          totalCompraElement.textContent = `Total: R$ ${total.toFixed(2)}`;
          // Atualiza o QR Code com o novo total
          atualizaQRCodePix(total);
        }
      }
    });
  });
});

/**
 * Função para gerar e atualizar o QR Code Pix de acordo com o total do carrinho.
 */
function atualizaQRCodePix(total) {
  // Cria o payload Pix com os dados fornecidos
  const brcode = Pix({
    version: '01',
    key: '4c5a1c62-0a1d-4761-ab63-668faa2adfe0',  // Sua chave Pix
    name: 'Fulano de Tal',   // Nome do recebedor (máximo 25 caracteres)
    city: 'SAO PAULO',       // Cidade (máximo 15 caracteres)
    transactionId: '***',    // Identificador da transação (até 25 chars)
    message: 'Carrinho Faculdade',
    value: total           // Valor do carrinho (número, ex: 10.50)
  });

  // Gera o QR Code em Base64
  const base64QrCode = brcode.base64();

  // Atualiza o src da imagem do QR Code
  document.getElementById('qrcode-pix').src = base64QrCode;
}
